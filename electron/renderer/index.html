<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; connect-src 'self' ws://127.0.0.1:8765 http://localhost:* http://127.0.0.1:*; script-src 'self'; style-src 'self'; media-src 'self' blob:;" />
  <title>Echo2Text – Transcription & Analysis</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<div id="app">

  <!-- ── Header ─────────────────────────────────────────────────────────── -->
  <header>
    <h1>Echo2Text &mdash; Transcription &amp; Real Time Analysis</h1>
    <div class="header-right">
      <div class="theme-switcher">
        <button class="theme-btn active" data-theme="dark"  title="Dark"></button>
        <button class="theme-btn"        data-theme="light" title="Light"></button>
        <button class="theme-btn"        data-theme="nord"  title="Nord"></button>
        <button class="theme-btn"        data-theme="sepia" title="Sepia"></button>
      </div>
      <div class="status-bar">
        <div class="status-item">
          <span class="dot" id="dot-server"></span>
          <span>ASR Server</span>
        </div>
        <div class="status-item">
          <span class="dot" id="dot-lmstudio"></span>
          <span>LMStudio</span>
        </div>
        <div class="status-item">
          <span class="dot" id="dot-mic"></span>
          <span>Microphone</span>
        </div>
      </div>
      <button id="btn-library">&#128193; Library</button>
    </div>
  </header>

  <!-- ── Controls ───────────────────────────────────────────────────────── -->
  <div class="controls">
    <button id="btn-start">&#9654; Start</button>
    <button id="btn-stop"  disabled>&#9632; Stop</button>
    <button id="btn-reset">&#8634; Reset</button>
    <div class="lang-toggle">
      <button class="lang-btn active" data-lang="fr">FR</button>
      <button class="lang-btn"        data-lang="en">EN</button>
    </div>
    <div class="audio-source-group">
      <label for="audio-source-select">&#127908;</label>
      <select id="audio-source-select"><option value="mic:default">System microphone</option></select>
      <button id="btn-refresh-sources" title="Refresh">&#8635;</button>
    </div>
    <div id="url-source-row" class="url-source-row hidden">
      <input id="url-web-input" type="text" placeholder="https://youtube.com/watch?v=… or any URL" />
      <button id="btn-open-url">&#8599; Open</button>
      <button id="btn-close-url">&#10005; Close</button>
    </div>
    <input type="file" id="audio-file-input" accept="audio/*,video/mp4,video/webm,video/ogg" style="display:none" />
    <div class="url-group">
      <label for="lmstudio-url">LMStudio URL</label>
      <input id="lmstudio-url" type="text" value="http://localhost:1234/v1" />
    </div>
  </div>

  <!-- ── Meeting context bar ────────────────────────────────────────────── -->
  <div id="meeting-context-bar" class="hidden">
    <span class="ctx-label">Active meeting:</span>
    <span id="ctx-company" class="ctx-company"></span>
    <span class="ctx-sep">›</span>
    <span id="ctx-title" class="ctx-title"></span>
    <button id="btn-change-meeting">Change</button>
  </div>

  <!-- ── Speakers panel ────────────────────────────────────────────────────── -->
  <div id="speakers-panel" class="card hidden">
    <div class="card-label">Speakers <span class="muted-label">(click to rename)</span></div>
    <div id="speakers-list" class="speakers-list"></div>
  </div>

  <!-- ── Transcription ───────────────────────────────────────────────────── -->
  <div class="card" id="live-text" style="flex: 0 0 200px;">
    <div class="card-label">Live Transcription</div>
    <div id="transcript-display" class="transcript-display"></div>
    <textarea id="transcript-area" readonly style="display:none"></textarea>
  </div>

  <!-- ── Q&A ────────────────────────────────────────────────────────────── -->
  <div class="qa-row">
    <div class="card">
      <div class="card-label">Detected questions <span class="label-badge">real-time</span></div>
      <div class="list-box" id="questions-list"></div>
    </div>
    <div class="card">
      <div class="card-label">Action items <span class="label-badge">end of meeting</span></div>
      <div class="list-box" id="actions-list"></div>
    </div>
  </div>

  <!-- ── Summary ───────────────────────────────────────────────────────── -->
  <div class="card hidden" id="summary-card">
    <div class="card-label">Meeting Summary <span class="label-badge">end of meeting</span></div>
    <div id="summary-content"></div>
  </div>

  <!-- ── Export ─────────────────────────────────────────────────────────── -->
  <div class="export-row">
    <button id="btn-csv" disabled>&#8595; CSV</button>
    <button id="btn-srt" disabled>&#8595; SRT</button>
  </div>

  <!-- ── Timestamps table ───────────────────────────────────────────────── -->
  <div class="card" id="timestamps-card" style="flex: 1; min-height: 0;">
    <div class="card-label">Timestamped segments</div>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Start (s)</th>
            <th>End (s)</th>
            <th>Speaker</th>
            <th>Segment</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="timestamps-body"></tbody>
      </table>
    </div>
  </div>

</div>

<!-- ── Library overlay ────────────────────────────────────────────────────── -->
<div id="library-overlay" class="hidden">
  <div id="library-panel">
    <div id="lib-companies-col">
      <div class="lib-col-header">
        <span>Companies</span>
        <button id="btn-new-company" class="btn-icon">+</button>
      </div>
      <div id="lib-companies-list"></div>
    </div>
    <div id="lib-content-col">
      <div id="lib-meetings-pane" class="hidden">
        <div class="lib-col-header">
          <span id="lib-company-name-title"></span>
          <button id="btn-new-meeting-from-lib" class="btn-sm">+ New meeting</button>
        </div>
        <div id="lib-meetings-list"></div>
      </div>
      <div id="lib-meeting-detail" class="hidden"></div>
      <div id="lib-empty-hint">
        <p>Select a company to view its meetings.</p>
      </div>
    </div>
  </div>
  <button id="btn-close-library" class="btn-close-overlay">&#10005;</button>
</div>

<!-- ── Meeting setup modal ────────────────────────────────────────────────── -->
<div id="meeting-setup-modal" class="hidden">
  <div class="modal-backdrop"></div>
  <div class="modal-card">
    <h2>New meeting</h2>
    <div class="modal-field">
      <label>Company</label>
      <div class="modal-row">
        <select id="modal-company-select"></select>
        <button id="modal-btn-new-company" class="btn-sm">+ New</button>
      </div>
    </div>
    <div id="modal-new-company-form" class="hidden">
      <div class="modal-field">
        <label>Company name</label>
        <input id="modal-new-company-name" type="text" placeholder="e.g. ACME Corp" />
      </div>
    </div>
    <div class="modal-field">
      <label>Meeting title</label>
      <input id="modal-title" type="text" placeholder="e.g. Q2 kick-off meeting" />
    </div>
    <div class="modal-field">
      <label>Description <span class="muted-label">(optional)</span></label>
      <textarea id="modal-desc" placeholder="Context, agenda…" rows="3"></textarea>
    </div>
    <div class="modal-actions">
      <button id="modal-btn-cancel">Cancel</button>
      <button id="modal-btn-confirm" class="btn-primary">&#9654; Start</button>
    </div>
  </div>
</div>

<script src="app.js"></script>
<script src="library.js"></script>
</body>
</html>
